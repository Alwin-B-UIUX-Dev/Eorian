#!/usr/bin/env sh
# V√©rifie seulement si c'est un checkout de branche

if [ "$3" = "1" ]; then
  branch=$(git rev-parse --abbrev-ref HEAD)

  # Ignore les branches syst√®me
  if [ "$branch" = "main" ] || [ "$branch" = "develop" ] || [ "$branch" = "HEAD" ]; then
    exit 0
  fi

  # V√©rifie le format
  if ! echo "$branch" | grep -qE "^(feature|fix|setup|docs|style|refactor|test|chore|release|hotfix)\/[a-z0-9-]+$"; then
    echo "‚ùå Nom de branche invalide: $branch"
    echo "‚úÖ Formats accept√©s: feature/xxx, fix/xxx, docs/xxx, etc."
    echo "üí° Renommez avec: git branch -m $branch feature/nouvelle-branche"
    exit 1
  fi

  echo "‚úÖ Nom de branche valide: $branch"
fi


echo "‚úÖ Push autoris√© pour: $branch"


# Lance les tests avant le push
npm run test
